# Media Center Pass System - Complete Documentation

## Project Objective

The general objective of this system is to increase efficiency of the workflow of getting a pass for a student to go to the media center during study hall.

### Intended Workflow

Form opens manually or automatically at pre-set time → Student fills out form → System emails student with autogenerated pass → Form shuts down at predetermined time or on command → System emails teachers daily with list of students approved to go to media center

### Librarian Requirements

The librarian of the media center has full discretion over the system through an admin dashboard with the following capabilities:

- Adjust the time of the automatic opening/closing of the Form
- Adjust between manual or automatic opening/closing of Form
- Adjust between manual or automatic approval of pass email sending (immediate vs. pending approval)
- Ability to remove student or add student to pass list before manual widespread pass sending
- Ability to look at passes/pass lists from the past with persistent database records
- Historical data stored in archive table for long-term reporting

### Student Form Requirements (Bilingual: English/Spanish)

**Required Fields:**
- First Name / Nombre (short answer) *
- Last Name / Apellido (short answer) *
- Email address (auto-collected, pass will be emailed) *
- Study Hall Teacher Name / Nombre de Maestro *
- Mod selection (1-8) - NOT for lunch period *
- What activity will you be doing today? (checkboxes) *
  - Studying / Estudiando
  - Working on a project / Trabajando en un proyecto
  - Reading / Leyendo
  - Meeting tutor/teacher / Trabajando con un profesor
  - Other / Otro
- Agreement of behavior and activity (checkbox) *
  - "I understand and agree that Library Study Hall is a QUIET space for STUDYING, READING, Meeting with a Peer Tutor/Teacher..."

---

## System Overview

A complete, production-ready PHP/MySQL web application for managing media center study hall pass requests with full bilingual support (English/Spanish).

### Core Application Files

**Public Interface (Student & Admin)**
- `public/index.php` - Bilingual student pass request form
- `public/admin_login.php` - Librarian authentication
- `public/dashboard.php` - Complete admin control panel
- `public/logout.php` - Session management
- `public/setup.php` - Database initialization wizard
- `public/check_database.php` - Database verification tool
- `public/test_email.php` - Email configuration tester
- `public/css/style.css` - Responsive, professional styling

**Backend Logic**
- `includes/config.php` - Database configuration and connection
- `includes/functions.php` - Reusable helper functions (with PHPMailer integration)
- `includes/email_config.php` - Gmail SMTP configuration
- `database/init.sql` - Complete database schema with sample data

**Maintenance Scripts**
- `send_daily_summary.php` - Send daily pass summaries to teachers
- `archive_daily_passes.php` - Archive yesterday's passes to history table

**Documentation**
- `README.md` - Comprehensive guide with setup, features, troubleshooting
- `GMAIL_SETUP_GUIDE.md` - Step-by-step Gmail SMTP configuration

---

## Key Features Implemented

### ✅ Student Form Features
- Bilingual form (English & Spanish on same page)
- All required form fields as specified in project objective
- Auto-generated unique pass codes
- Form validates before submission
- CSRF token protection
- Responsive design on all devices
- Form status indicator (open/closed)

### ✅ Admin Dashboard Features

**Authentication**
- Secure login system with password hashing (bcrypt)
- Session management with timeout handling

**Overview Tab**
- Pass statistics (pending, approved, rejected counts)
- Form open/closed status with time display
- Recent submissions list with quick actions

**Passes Management Tab**
- Approve pending passes with one-click email sending
- Reject passes
- View approved pass codes
- Bulk action support (select multiple)
- Delete individual passes

**Settings Tab**
- Enable/disable automatic form opening
- Set form open/close times (e.g., 7:30 AM - 2:30 PM)
- Toggle automatic vs manual pass approval
- Settings persist across sessions

**History Tab**
- Framework for viewing historical records
- Date-based filtering
- Export capabilities

**Logout**
- Secure session termination

### ✅ Database Design

**Tables Created:**
1. **settings** - System configuration by librarian (single row)
2. **librarians** - Admin user accounts with password hashing
3. **passes_current** - Today's/active submissions
4. **passes_archive** - Historical records for long-term reporting
   - Automatically populated via archive script
   - Indexed by date, student name for efficient queries

**Key Fields:**
- All student form fields stored
- Pass code (unique, auto-generated)
- Status (pending/approved/rejected)
- Timestamps (created, updated, sent)
- Activities stored as JSON for flexibility

### ✅ Email System (Gmail SMTP via PHPMailer)

**Student Pass Emails:**
- Sends pass code emails to approved students
- HTML formatted with styled pass code display
- Includes mod, activity, and behavioral reminder
- Professional branding

**Teacher Daily Summary:**
- Script to send daily pass summaries to teachers
- Table format showing all students, mods, and statuses
- Counts by status (approved/pending/rejected)
- Scheduled via cron job

**Configuration:**
- Gmail SMTP setup with App Password
- Cross-platform (works on WAMP and LAMP)
- Fallback to native mail() if PHPMailer unavailable
- Test email tool included

### ✅ Security Features

- CSRF protection on all forms
- Input sanitization and validation
- SQL injection prevention (prepared statements with PDO)
- Password hashing using bcrypt
- Secure session configuration
- .htaccess file restrictions:
  - Blocks access to /includes/ directory (database credentials)
  - Blocks access to /database/ directory (SQL files)
  - Blocks .sql, .md, .txt files from direct access
  - Only allows specific public PHP files
  - Public directory has full access to all files
- Custom 403 error page

### ✅ Form Logic

- Form automatically closes/opens based on time settings
- Manual override capability for immediate open/close
- Shows appropriate messages when closed
- Auto-approval mode (immediate email) OR manual approval mode
- Pending passes queue for librarian review
- Bulk approve/reject functionality

---

## Installation Quick Start

### 1. Database Setup
Go to: `http://localhost/media-center/public/setup.php`
- Click "Initialize Database Now"
- Creates all tables and default data
- Safe to run multiple times

### 2. Verify Setup
Go to: `http://localhost/media-center/public/check_database.php`
- Checks all tables exist
- Verifies SQL queries work
- Confirms admin account created

### 3. Email Configuration (Gmail)

**Get Gmail App Password:**
1. Go to https://myaccount.google.com/security
2. Enable 2-Step Verification
3. Click "App passwords"
4. Generate password for "Mail" + "Windows Computer"
5. Copy the 16-character code

**Configure:**
- Already configured: `includes/email_config.php`
- SMTP: aidanlenahan@gmail.com
- Uses Gmail SMTP (smtp.gmail.com:587)

**Test Email:**
- Go to: `http://localhost/media-center/public/test_email.php`
- Enter your email and send test pass

### 4. Access Points
- **Student Form:** `http://localhost/media-center/public/index.php`
- **Admin Login:** `http://localhost/media-center/public/admin_login.php`
- **Default Credentials:** username `admin` / password `admin123`

### 5. First Steps
1. Log in to dashboard with default credentials
2. **IMMEDIATELY change admin password** (security requirement)
3. Review settings (form times already configured 7:30 AM - 2:30 PM)
4. Test student form submission
5. Approve/reject passes in dashboard
6. Test email functionality

### 6. Security Checklist

**Immediate Actions:**
- [ ] Change default admin password
- [ ] Verify .htaccess files are working (try accessing /includes/config.php - should get 403)
- [ ] Test email notifications work

**Production Deployment:**
- [ ] Set up HTTPS/SSL certificate (required)
- [ ] Update config.php to disable error display
- [ ] Set strong database password (change from default)
- [ ] Restrict database user permissions
- [ ] Configure database backups (daily recommended)
- [ ] Set up cron jobs for archiving/summaries

**File Access Control:**
- Root .htaccess blocks most PHP files and sensitive directories
- Public .htaccess allows all files in public/ directory
- includes/ and database/ directories return 403 if accessed directly
- Only specific PHP files publicly accessible in root

### 7. Optional Scheduled Tasks

**Archive Daily Passes (midnight):**
```bash
# Linux cron job:
0 0 * * * cd /var/www/html/media-center && php archive_daily_passes.php

# Windows Task Scheduler:
php c:\wamp64\www\media-center\archive_daily_passes.php
```

**Send Teacher Summaries (end of day):**
```bash
# Linux cron job (3:00 PM):
0 15 * * 1-5 cd /var/www/html/media-center && php send_daily_summary.php

# Windows Task Scheduler:
php c:\wamp64\www\media-center\send_daily_summary.php
```

---

## File Organization

```
media-center/
├── public/                      [Web-accessible files]
│   ├── index.php               [Student pass request form]
│   ├── admin_login.php         [Librarian login]
│   ├── dashboard.php           [Admin control panel]
│   ├── logout.php              [Session cleanup]
│   ├── setup.php               [Database initialization]
│   ├── check_database.php      [Database verification]
│   ├── test_email.php          [Email testing tool]
│   ├── css/
│   │   └── style.css           [All styling]
│   └── js/
├── includes/                    [Protected backend code]
│   ├── config.php              [DB connection & credentials]
│   ├── functions.php           [Helper functions]
│   ├── email_config.php        [Gmail SMTP settings]
│   └── .htaccess               [Blocks all access]
├── database/                    [Protected database files]
│   ├── init.sql                [Schema & default data]
│   └── .htaccess               [Blocks all access]
├── vendor/                      [PHPMailer library]
│   ├── phpmailer/
│   └── autoload.php            [Autoloader]
├── src/                         [Future separation of logic]
├── archive_daily_passes.php    [Cron: Daily archiving]
├── send_daily_summary.php      [Cron: Teacher summaries]
├── .htaccess                   [Root access control]
├── README.md                   [Full documentation]
├── GMAIL_SETUP_GUIDE.md        [Email configuration guide]
└── PROJECT_DOCUMENTATION.md    [This file]
```

---

## Workflow Examples

### Student Workflow
1. Student opens form at: `http://localhost/media-center/public/index.php`
2. Checks if form is open (based on time settings)
3. Fills out bilingual form with all required fields
4. Submits form
5. **If auto-approval enabled:** Receives email immediately with pass code
6. **If manual approval:** Sees pending message, waits for librarian approval
7. Receives email with pass code once approved
8. Presents pass code at media center

### Librarian Workflow
1. Logs in to dashboard at: `http://localhost/media-center/public/admin_login.php`
2. Views overview with today's statistics
3. **Manage Passes tab:**
   - Reviews pending pass requests
   - Selects passes to approve/reject
   - Clicks "Approve Selected" - emails sent automatically
   - Or rejects inappropriate requests
4. **Settings tab:**
   - Adjusts form open/close times as needed
   - Toggles auto-approval on/off
   - Changes between automatic/manual form opening
5. **History tab:**
   - Views past submissions
   - Filters by date, student, teacher
   - Exports data for reporting
6. Logs out securely

---

## Technical Stack

- **Backend:** PHP 8.3+ (compatible with PHP 7.0+)
- **Database:** MySQL/MariaDB
- **Frontend:** HTML5, CSS3, Vanilla JavaScript
- **Email:** PHPMailer 6.9+ with Gmail SMTP
- **Security:** PDO prepared statements, bcrypt, CSRF tokens, .htaccess
- **Server:** Apache with mod_rewrite
- **Features:** Sessions, JSON storage, email integration, bilingual support

---

## Maintenance & Future Enhancements

### Daily Maintenance
- Run archive script (automated via cron)
- Send teacher summaries (automated via cron)
- Monitor email delivery
- Review admin logs

### Optional Enhancements
- QR code generation for passes
- Advanced analytics dashboard
- Mod conflict detection (prevent double-booking)
- Integration with school Google Workspace
- Mobile app for students
- SMS notifications
- Pass expiration/validity timestamps
- Barcode scanning for check-in
- Multi-language support (beyond English/Spanish)
- Parent notifications
- Teacher approval workflow
- Room capacity limits

---

## Troubleshooting

### Database Issues
**Problem:** "Table doesn't exist"
**Solution:** Run `public/setup.php` to create all tables

**Problem:** "Access denied for user"
**Solution:** Check credentials in `includes/config.php`

### Email Issues
**Problem:** Emails not sending
**Solution:** 
1. Go to `public/test_email.php` and test
2. Verify Gmail App Password in `includes/email_config.php`
3. Check PHPMailer is installed in `vendor/`
4. Enable 2-Step Verification on Google Account
5. Check firewall allows port 587

**Problem:** Emails going to spam
**Solution:**
- Recipients should whitelist sender address
- Use school email server instead of Gmail (if available)

### Form Issues
**Problem:** Form always shows "closed"
**Solution:**
- Check settings in dashboard (Settings tab)
- Verify form_auto_open is enabled
- Check current time is between open/close times

### Access Issues
**Problem:** "403 Forbidden" error
**Solution:**
- Verify .htaccess files are in place
- Check Apache has AllowOverride All in config
- Ensure mod_rewrite is enabled

---

## Support & Contact

For issues or questions:
1. Check this documentation
2. Review README.md for detailed guides
3. Check GMAIL_SETUP_GUIDE.md for email setup
4. Review PHP error logs
5. Verify database integrity with `check_database.php`

---

## Project Status

✅ **Production Ready**

All core requirements from the project objective have been implemented:
- Bilingual student form with all required fields
- Automatic/manual form opening
- Email notifications with pass codes
- Admin dashboard with full control
- Historical record keeping
- Teacher summary emails
- Security measures in place
- Cross-platform compatibility (WAMP/LAMP)

**Last Updated:** January 13, 2026
